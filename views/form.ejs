<!-- Compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
<!--<h1>Form aayga yha</h1>-->
<body>

<h2 style="text-align: center">Dreeco</h2>
    <div class="row">
        <div class="col m2"></div>
        <div class="col m8">
            <div class="container" style="width: 100%" id="form">
                <div class="row">
                    <div class="col m1"></div>
                    <div class="col m10">
                        <div class="row">
                            <div class="col s12">
                                <h4 class="center-align">Vendor's Form</h4>
                                <div class="row">
                                    <form class="col s12" action="/" method="POST" enctype="multipart/form-data">
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <input id="first_name" name="name" type="text" class="validate">
                                                <label for="first_name">Name</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <label for="availability">Availability</label>
                                                <br/>
                                            </div>
                                            <div class="input-field col s12">
                                                <select class="browser-default" id="availability" name="availability">
                                                    <option value="1">Seasonal</option>
                                                    <option value="2">Yearly</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <input id="number" type="text" class="validate" name="number" >
                                                <label for="number">Number</label>
                                            </div>
                                            <div class="input-field col s12">
                                                <div class="file-field">
                                                    <div class="btn btn-primary btn-sm float-left">
                                                        <span>Choose Image</span>
                                                        <input type="file" name="image">
                                                    </div>
                                                    <div class="file-path-wrapper">
                                                        <input class="file-path validate" name="fileName" type="text" placeholder="Upload one or more files">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <label>Menu</label>
                                                <br><br>
                                            </div>
                                            <div class="col s6"><h5>Food</h5></div>
                                            <div class="col s6"><h5>Drinks</h5></div>
                                            <div class="col s6">
                                                <table name="ftable">
                                                    <thead>
                                                    <tr>
                                                        <th>Item</th>
                                                        <th>Price</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="food">
                                                        <td>
                                                            <input type="text" name="fitem[]">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="fprice[]">
                                                        </td>
                                                    </tbody>
                                                </table>
                                                <button class="btn waves-effect waves-light" id="addFoodItem" type="button">Add More</button>
                                            </div>

                                            <div class="col s6">
                                                <table name="dtable">
                                                    <thead>
                                                    <tr>
                                                        <th>Item</th>
                                                        <th>Price</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="drink">
                                                        <td>
                                                            <input type="text" name="ditem[]">
                                                        </td>
                                                        <td>
                                                            <input type="text" name="dprice[]">
                                                        </td>
                                                    </tbody>
                                                </table>
                                                <button class="btn waves-effect waves-light" id="addDrinkItem" type="button">Add More</button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <label for="payment">Payment methods</label>
                                                <br/>
                                            </div>
                                            <div class="input-field col s12">
                                                <select multiple id="payment" name="payment">
                                                    <option disabled selected>Choose your option</option>
                                                    <option value="1">COD</option>
                                                    <option value="2">Paytm</option>
                                                    <option value="3">Card</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">

                                            <div class="input-field col s12">
                                                <label for="weekly">Hygiene Rating</label>
                                                <br/>
                                            </div>
                                            <div class="input-field col s12">
                                                <select class="browser-default" id="weekly" name="weekly">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="3">4</option>
                                                    <option value="3">5</option>
                                                </select>
                                            </div>
                                            <div class="input-field col s12">
                                                <label for="monthly">Taste Rating</label>
                                                <br/>
                                            </div>
                                            <div class="input-field col s12">
                                                <select class="browser-default" id="monthly" name="monthly">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="3">4</option>
                                                    <option value="3">5</option>
                                                </select>
                                            </div>
                                            <div class="input-field col s12">
                                                <label for="dumping">Dumping Facility</label>
                                                <br/>
                                            </div>
                                            <div class="input-field col s12">
                                                <select class="browser-default" id="dumping" name="dumping">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="3">4</option>
                                                    <option value="3">5</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <label for="smartphone">Smartphone</label>
                                                <br/>
                                            </div>
                                            <div class="input-field col s12">
                                                <select class="browser-default" id="smartphone" name="smartphone">
                                                    <option value="1">Available</option>
                                                    <option value="2">Unavailable</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s12">
                                                <label for="location">Location/Time</label>
                                                <br><br>
                                            </div>
                                            <div class="col s12" id="location">
                                                <!--<div class="row">-->
                                                    <!--<div class="col s12">-->
                                                        <!--<label for="end">Location</label>-->
                                                    <!--</div>-->
                                                    <!--<div class="input-field col s12">-->
                                                        <!--<label for="start">Start time</label>-->
                                                    <!--</div>-->
                                                    <!--<div class="input-field col s12">-->
                                                        <!--<label for="last">Last time</label>-->
                                                    <!--</div>-->
                                                <!--</div>-->
                                                <!--<input id="start" readonly value="India">-->
                                                <!--<input type="button" value="GO" onclick="calcRoute()">-->



                                                <div id="map"></div>
                                                <style>
                                                    #map {
                                                        height: 400px;
                                                    }
                                                </style>
                                            </div>
                                            <div class="row">
                                                <div class="col s6">
                                                    <input type="button" class="btn" value="Add Another Location"
                                                           onclick="dropPin()">
                                                </div>
                                                <div class="col s6">
                                                    <input type="button" class="btn" value="Get PinCode"
                                                           onclick="finalize()"><br>
                                                </div>
                                                <div class="col s12">
                                                    <input id="end">
                                                </div>
                                            </div>
                                        </div>
                                        <!--<div class="row">-->
                                            <!--<div class="col s3">-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <div class="row">
                                            <div class="col s12"><h5>Location and time table</h5></div>
                                            <div class="col s12">
                                                <table name="ltable">
                                                    <thead>
                                                    <tr>
                                                        <th>LatLngs</th>
                                                        <th>Start Time</th>
                                                        <th>End Time</th>
                                                        <th>Pin Code</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="lAndT">

                                                    </tbody>
                                                </table>
                                                <!--<button class="btn btn-large waves-effect waves-light" id="addlAndT" type="button">Add Another Entry</button>-->
                                            </div>
                                        </div>
                                        <!--<div class="row">-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<label for="presence">Moving/Stationary</label>-->
                                                <!--<br/>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<select class="browser-default" id="presence" name="presence">-->
                                                    <!--<option value="1">Stationary</option>-->
                                                    <!--<option value="2">Moving</option>-->
                                                <!--</select>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<div class="row" id="presence1">-->
                                            <!--<div class="col s12">-->
                                                <!--<h4>Staionary</h4>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<label for="seating">Seating</label>-->
                                                <!--<br/>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<select class="browser-default" id="seating" name="seating">-->
                                                    <!--<option value="1">Available</option>-->
                                                    <!--<option value="2">Unavailable</option>-->
                                                <!--</select>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<label for="delivery">Delivery</label>-->
                                                <!--<br/>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<select class="browser-default" id="delivery" name="delivery">-->
                                                    <!--<option value="1">Available</option>-->
                                                    <!--<option value="2">Unavailable</option>-->
                                                <!--</select>-->
                                            <!--</div>-->

                                            <!--<div id="availableBlock">-->
                                                <!--<div class="input-field col s12">-->
                                                    <!--<label for="dAvailable">Delivery Available</label>-->
                                                    <!--<br/>-->
                                                <!--</div>-->
                                                <!--<div class="input-field col s12">-->
                                                    <!--<select class="browser-default" id="dAvailable" name="dAvailable">-->
                                                        <!--<option value="1">Personal</option>-->
                                                        <!--<option value="2">Food Tech</option>-->
                                                    <!--</select>-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<div class="row" id="presence2" style="display: none;">-->
                                            <!--<div class="col s12">-->
                                                <!--<h4>Moving</h4>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<label for="route">Route</label>-->
                                                <!--<br/>-->
                                            <!--</div>-->
                                            <!--<div class="input-field col s12">-->
                                                <!--<select class="browser-default" id="route" name="route">-->
                                                    <!--<option value="1">Similar</option>-->
                                                    <!--<option value="2">Different</option>-->
                                                <!--</select>-->
                                            <!--</div>-->
                                            <!--&lt;!&ndash;<div class="input-field col s12">&ndash;&gt;-->
                                                <!--&lt;!&ndash;<label for="delivery">Delivery</label>&ndash;&gt;-->
                                                <!--&lt;!&ndash;<br/>&ndash;&gt;-->
                                            <!--&lt;!&ndash;</div>&ndash;&gt;-->
                                            <!--&lt;!&ndash;<div class="input-field col s12">&ndash;&gt;-->
                                                <!--&lt;!&ndash;<select class="browser-default" id="delivery">&ndash;&gt;-->
                                                    <!--&lt;!&ndash;<option value="1">Available</option>&ndash;&gt;-->
                                                    <!--&lt;!&ndash;<option value="2">Unavailable</option>&ndash;&gt;-->
                                                <!--&lt;!&ndash;</select>&ndash;&gt;-->
                                            <!--&lt;!&ndash;</div>&ndash;&gt;-->
                                        <!--</div>-->

                                        <div class="divider"></div>
                                        <div class="row">
                                            <div class="col m12">
                                                <p class="right-align"><button class="btn btn-large waves-effect waves-light">Submit</button></p>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col m1"></div>
                </div>
        </div>
        <div class="col m2"></div>
    </div>
</div>
</body>
<style>
    #form{
        border: 10px solid #af00b7;
    }
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQ27fB6HLMOlQLeNqsl2GQh_yIH1T8igs"></script>
<script>
    // var directionsDisplay;
    // var directionsService = new google.maps.DirectionsService();
    var map;
    var endMarker;
    var geocoder;
    var infoWindow;

    function initialize() {
        directionsDisplay = new google.maps.DirectionsRenderer();
        var india = new google.maps.LatLng(28.5272181,77.0688971);
        var mapOptions = {
            zoom: 12,
            center: india
        }
        geocoder = new google.maps.Geocoder;
        map = new google.maps.Map(document.getElementById("map"), mapOptions);
        // directionsDisplay.setMap(map);
        infoWindow = new google.maps.InfoWindow;
        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                infoWindow.open(map);
                map.setCenter(pos);
            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }
    }

    function geocodeLatLng(geocoder, map, infowindow) {
        var input = document.getElementById('end').value;
        var latlngStr = input.split(',', 2);
        var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
        geocoder.geocode({'location': latlng}, function(results, status) {
            if (status === 'OK') {
                if (results[0]) {
                    map.setZoom(12);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map
                    });
                    infowindow.setContent(results[0].formatted_address);
                    infowindow.open(map, marker);
                    console.log(results[0]);
                    var searchAddressComponents = results[0].address_components,
                        searchPostalCode="";

                    $.each(searchAddressComponents, function(){
                        if(this.types[0]=="postal_code"){
                            searchPostalCode=this.short_name;
                        }
                    });

                    console.log(searchPostalCode);
                    document.getElementsByClassName("pin")[document.getElementsByClassName("pin").length - 1].value =
                        searchPostalCode;

                } else {
                    window.alert('No results found');
                }
            } else {
                window.alert('Geocoder failed due to: ' + status);
            }
        });
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }

    function dropPin() {
        $("#lAndT").append("<tr><td><input name='location[]' class='location'></td><td><input type='text' " +
            "class='timepicker " +
            "validate' name='start[]' ></td><td><input type='text' class='timepicker validate' name='last[]' " +
            "></td><td><input type='text' name='pin[]' class='pin'></td></tr>");

        $(document).ready(function(){
            $('.timepicker').timepicker();
        });
        // if any previous marker exists, let's first remove it from the map
        if (endMarker) {
            endMarker.setMap(null);
        }
        // create the marker
        endMarker = new google.maps.Marker({
            position: map.getCenter(),
            map: map,
            draggable: true,
        });
        copyMarkerpositionToInput();
        // add an event "onDrag"
        google.maps.event.addListener(endMarker, 'dragend', function() {

            copyMarkerpositionToInput();
        });
    }

    function copyMarkerpositionToInput() {
        // get the position of the marker, and set it as the value of input
        document.getElementById("end").value = endMarker.getPosition().lat() +','+  endMarker.getPosition().lng();
        document.getElementsByClassName("location")[document.getElementsByClassName("location").length-1].value = endMarker
            .getPosition().lat() +','+  endMarker
            .getPosition().lng();
        // geocodeLatLng(geocoder, map, infoWindow);
    }

    google.maps.event.addDomListener(window, 'load', initialize);



    $("#addFoodItem").on("click", function () {
        $('#food').append("<tr><td><input type='text' name='fitem[]' /></td><td><input type='text' name='fprice[]' /></td></tr>");
    });
    $("#addDrinkItem").on("click", function () {
        $('#drink').append("<tr><td><input type='text' name='ditem[]' /></td><td><input type='text' name='dprice[]' /></td></tr>");
    });

    function finalize(){
        geocodeLatLng(geocoder, map, infoWindow);

    }

    // $("#addlAndT").on("click", function () {
    //
    // });

    $("body").on("change", "#presence", function () {
        if($("#presence").val() == 1){
            $("#presence1").css("display", "block");
            $("#presence2").css("display", "none");
        }else{
            $("#presence1").css("display", "none");
            $("#presence2").css("display", "block");
        }
    });

    $("body").on("change", "#delivery", function () {
        if($("#delivery").val() == 1)
            $("#availableBlock").css("display", "block");
        else
            $("#availableBlock").css("display", "none");
    });

    $(document).ready(function(){
        $('.timepicker').timepicker();
    });
    $(document).ready(function(){
        $('select').formSelect();
    });

</script>